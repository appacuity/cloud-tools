customRules:
  rules-appacuity.yaml : |-  
    - macro: egress_flows
      condition: >
        (((evt.type = connect and evt.dir=<) or
        (evt.type in (sendto,sendmsg) and evt.dir=< and
        fd.l4proto != tcp and fd.connected=false and fd.name_changed=true)) and
        (fd.typechar = 4 or fd.typechar = 6) and
        (fd.net != "127.0.0.0/8") and
        (evt.rawres >= 0 or evt.res = EINPROGRESS))
    - list: ignored
      items: [ '"falco"', '"kube-system"' ]
    - rule: Kubernetes Pod Egress
      desc: A pod in namespace attempted a network connection
      condition: egress_flows and k8s.ns.name != "" and not k8s.ns.name in (ignored)
      output: "Network traffic connection FROM a Pod: (pod=%k8s.pod.name namespace=%k8s.ns.name srcip=%fd.cip dstip=%fd.sip dstport=%fd.sport proto=%fd.l4proto procname=%proc.name, server=%fd.is_server)"
      priority: INFO
    - macro: ingress_flows
      condition: >
        (((evt.type in (accept,listen,connect) and evt.dir=<) or
        (evt.type in (recvfrom,recvmsg) and evt.dir=< and
        fd.l4proto != tcp and fd.connected=false and fd.name_changed=true)) and
        (fd.typechar = 4 or fd.typechar = 6) and
        (fd.net != "127.0.0.0/8") and
        (evt.rawres >= 0 or evt.res = EINPROGRESS))
    - rule: Kubernetes Pod Ingress
      desc: A pod in namespace received a network connection
      condition: ingress_flows and k8s.ns.name != "" and not k8s.ns.name in (ignored)
      output: "Network traffic connection TO Pod: (pod=%k8s.pod.name namespace=%k8s.ns.name srcip=%fd.cip dstip=%fd.sip dstport=%fd.sport proto=%fd.l4proto procname=%proc.name, server=%fd.is_server))"
      priority: INFO
